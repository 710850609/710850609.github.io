---
layout: post
title:  开发常用SQL
date:   2018-12-29 15:24:00 +0800
categories: 数据库
tag: SQL
---

* content
{:toc}


## 一、DML语句
### 1、如果记录不存在则`INSERT`，如果存在则不`INSERT`
#### a、使用场景
- 合适单条记录的 insert操作
- 合适insert的字段不存在唯一约束
- 合适不存在记录则insert，存在则不insert

#### b、模板
```sql
insert into {table_name} ({column_name1}, {column_name2}, {column_name3}) 
select {value1}, {value2}, {value3}, {value4}  from dual 
where not exists (select 1 from {table_name} where {column_name}={VALUE})
```
#### c、示例
- sql

```sql
insert into `config`(`name`, `key`, `value`, `remark`, `create_time`) 
select '汇率', 'rate', '4', '汇率', now() from dual
where not exists (select 1 from config where key='rate');
```
-  说明
如果sql执行前数据库的数据是
|`id`|`name`|
| -- | ---- |
|1|汇率|

### 2、如果记录不存在则`INSERT`，如果存在则`UPDATE`
#### a、使用场景
- insert字段中存在唯一约束字段（主键或唯一索引字段或联合索引字段）
- 合适多条`insert`或`update`混合操作
- 合适批量`insert`，且`insert`前需要对记录判断是否已存在，如果不存在才`insert`

#### b、模板
```sql
insert into {table_name} ({column_name1}, {column_name2}, {column_name3}) values 
({column_value11}, {column_value22}, {column_value33}),
({column_value11}, {column_value22}, {column_value33})
ON DUPLICATE KEY UPDATE
{column_name2} = values({column_name2}),
{column_name4} = values({column_name4})
```
#### c、示例
```sql
insert into `config` (`name`, `key`, `value`, `remark`, `create_time`) values 
('汇率', 'rate', '4', '汇率', now()),
('模式', 'model', 'dev', '模式', now()),
('日志记录', 'logger', '1', '是否记录日志', now())
ON DUPLICATE KEY UPDATE
`name` = values(`name`),
`value` = values(`value`),
`remark` = values(`remark`),
`update_time` = now()
```
数据

### 3、如果记录不存在则`INSERT`，如果存在则`DELETE`后`INSERT`
#### a、使用场景

#### b、模板
```sql

```
#### c、示例
```sql

```